---
import { CollectionEntry, getCollection } from "astro:content";

import { Image } from "@astrojs/image/components";

import BaseLayout from "../../layouts/BaseLayout.astro";
import Hero from "../../components/Hero.astro";
import { Icon } from "astro-icon";

interface Props {
  entry: CollectionEntry<"projects">;
}

// This is a dynamic route that generates a page for every Markdown file in src/content/
// Read more about dynamic routes and this `getStaticPaths` function in the Astro docs:
// https://docs.astro.build/en/core-concepts/routing/#dynamic-routes
export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<BaseLayout title={entry.data.title} description={entry.data.description}>
  <div class="mx-auto mt-10 max-w-3xl px-8">
    <header>
      <div>
        <a class="mb-4 underline-offset-4 hover:underline" href="/projects/"
          >Work</a
        >
        <Hero title={entry.data.title}>
          <div>
            <div class="mt-3 flex gap-5">
              {
                entry.data.tags.map((t) => (
                  <div class="text-grey-50 mt-4 rounded-full bg-sky-500 px-4 py-2 text-sm font-semibold lg:px-6">
                    {t}
                  </div>
                ))
              }
            </div>
            <p
              class="text-grey-700 dark:text-grey-200 mt-5 font-semibold lg:text-lg"
            >
              {entry.data.description}
            </p>

            <div>
              {
                entry.data.link && (
                  <a href={entry.data.link}>
                    <div class="mt-5 flex items-center gap-2">
                      <p class="font-semibold text-sky-600 dark:text-sky-300">
                        Live version
                      </p>
                      <Icon
                        name="mdi:link-box-variant"
                        class="h-6 w-6 text-sky-600 dark:text-sky-300"
                      />
                    </div>
                  </a>
                )
              }

              {
                entry.data.github && (
                  <a href={entry.data.github}>
                    <div class="mt-5 flex items-center gap-2">
                      <p class="font-semibold text-sky-600 dark:text-sky-300">
                        Github
                      </p>
                      <Icon
                        name="mdi:github"
                        class="h-6 w-6 text-sky-600 dark:text-sky-300"
                      />
                    </div>
                  </a>
                )
              }
            </div>
          </div>
        </Hero>
      </div>
    </header>
    <main class="mt-10">
      <div>
        {
          entry.data.img && (
            <Image
              src={entry.data.img}
              alt={entry.data.img_alt || ""}
              class="dark:shadow-grey-700 w-full rounded-lg shadow-lg"
              width={1472}
              height={871}
            />
          )
        }
        <article
          class="prose-grey prose mt-20 max-w-3xl dark:prose-invert lg:px-8"
        >
          <Content />
        </article>
      </div>
    </main>
  </div>
</BaseLayout>
